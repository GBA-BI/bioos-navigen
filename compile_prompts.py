import os
import glob

def compile_prompts():
    output_file = "GEMINI.md"
    source_dir = "system_prompt"

    # Get all .md files and sort them to ensure correct order (00, 01, 02...)
    files = sorted(glob.glob(os.path.join(source_dir, "*.md")))

    if not files:
        print(f"No markdown files found in {source_dir}/")
        return

    print(f"Compiling {len(files)} files into {output_file}...")

    try:
        with open(output_file, "w", encoding="utf-8") as outfile:
            # Optional: Add a header to warn developers
            outfile.write("<!-- \n")
            outfile.write("WARNING: This file is auto-generated from the system_prompt/ directory.\n")
            outfile.write("DO NOT EDIT THIS FILE DIRECTLY. Edit the source files in system_prompt/ instead.\n")
            outfile.write("Run 'python3 compile_prompts.py' to regenerate.\n")
            outfile.write("-->\n\n")

            for filepath in files:
                print(f"  - Adding {filepath}")
                with open(filepath, "r", encoding="utf-8") as infile:
                    content = infile.read()
                    outfile.write(content)
                    # Ensure there is spacing between modules
                    if not content.endswith("\n"):
                        outfile.write("\n")
                    outfile.write("\n")

        print(f"Successfully compiled to {output_file}")

    except Exception as e:
        print(f"Error compiling prompts: {e}")

if __name__ == "__main__":
    compile_prompts()
